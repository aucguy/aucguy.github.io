var base=base||{};!function(){var s,o=!1;base.indexFunc=function(e){base.loadAssets([["image/tiles","assets/image/tiles.png","spritesheet",{frameWidth:32,frameHeight:32,pixelated:!0}],["image/turtle","assets/image/turtle.png","spritesheet",{frameWidth:32,frameHeight:32,pixelated:!0}],["program/level1","assets/program/level1.sbl","text"],["program/level2","assets/program/level2.sbl","text"],["program/level3","assets/program/level3.sbl","text"],["level/level1","assets/level/level1.json","tilemap"],["level/level2","assets/level/level2.json","tilemap"],["level/level3","assets/level/level3.json","tilemap"]].concat([["scripts/app","app.min.js","script"]])),(s=new Image).onload=base.external(function(){o=!0}),s.src="assets/image/logo.png"},base.displayId="content",base.renderLoadingScreen=function(e,t,n){var a=document.getElementById(e);if(null!==a){var r=a.getContext("2d");if(null!==r){var i=r.canvas.width,l=r.canvas.height;r.fillStyle="#FFFFFF",r.fillRect(0,0,i,l),o&&r.drawImage(s,(i-s.width)/2,(l-s.height)/2),r.fillStyle="#000000",r.beginPath(),r.rect(20,l-40,i-40,20),r.stroke(),r.beginPath(),r.rect(20,l-40,n/(n+t)*(i-40),20),r.fill()}}}}();base=function(r){function a(e){I(errorCallbacks,T=e),console.error(e.stack);var t=document.getElementById("error div"),n=document.getElementById("error text"),a=document.getElementById(r.base.displayId||"display");n&&(n.innerHTML=e.stack),t&&(t.style.display="block"),a&&(a.style.display="none")}function t(e,t,n){if(!T)try{e.apply(t,n)}catch(e){a(e)}}function l(e){return function(){t(e,this,arguments)}}function e(n,a){return function(){var e=1==arguments.length?[arguments[0]]:Array.apply(null,arguments);e[0]=base.external(e[0]);var t=n.apply(null,e);return a.push(t),t}}function n(t,n){return function(e){t(e),n.splice(n.indexOf(e),1)}}function i(e,t,n,a){var r=l(n);e.addEventListener(t,r,a),A.push({element:e,event:t,ext:r,callback:n,capture:a})}function s(e,t,n){for(var a=0;a<A.length;a++){var r=A[a];if(r.element==e&&r.event==t&&r.callback==n){r.element.removeEventListener(t,r.ext),A.splice(a,1);break}}}function o(e){var t=M[e];if(!t)throw new Error("module '"+e+"' is not defined");return t.scope||(t.scope=t.initFunc()),t.scope}function c(e,t,n,a,r,i){return{type:n,id:e,url:t,data:a,extra:r||{},xhr:i||null}}function u(n,a,r,i){n in G||(m(),function(t,e,n,a){void 0===a&&(a=function(e){console.warn("asset '"+t+"' failed to load with a status of "+e.status)});var r=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");r.responseType=e?"arraybuffer":"text",r.onreadystatechange=l(function(){4==r.readyState&&(200==r.status||0===r.status?n(r):a(r))}),r.open("GET",t,!0),r.send()}(p(R,a),"audio"==r,function(e){try{var t=-1!=["json","tilemap"].indexOf(r)?JSON.parse(e.response):e.response;G[n]=c(n,a,r,t,i,e),g()}catch(e){throw g(),e}},function(e){throw g(),new Error("failed to retrieve asset "+n)}))}function d(e,t,n,a){if(!(e in G)){m();var r=document.createElement(q[n]||n);"script"==n?(document.head.appendChild(r),r.onload=g):r.onload=base.external(function(){G[e]=c(e,t,n,r,a),g()}),r.onerror=base.external(function(){throw new Error("failed to load asset '"+e+"' at '"+t+"'")}),r.src=p(R,t)}}function f(e,t,n,a){"text"==q[n]||"audio"==n&&H?u(e,t,n,a):d(e,t,n,a)}function m(){W=W<0?1:W+1}function g(){W--,X++}function p(){for(var e=[],t=0,n=arguments.length;t<n;t++)e=e.concat(arguments[t].split("/"));var a=[];for(t=0,n=e.length;t<n;t++){var r=e[t];r&&"."!==r&&(".."===r?a.pop():a.push(r))}return(e[0].startsWith("/")||e[0].startsWith("\\"))&&a.unshift(""),a.join("/")||(a.length?"/":".")}function v(e,t,n){null!==r.base.renderLoadingScreen&&r.base.renderLoadingScreen(e,t,n)}function h(){b(),v(z,W,X),0===W&&(x(U.APP_INITING),mainModule=o("main"),mainModule.init(),x(U.APP_RUNNING))}function b(){K==U.INDEX_NOT_LOADED&&null!==r.base.indexFunc&&(r.base.indexFunc(),x(U.ASSETS_LOADING))}function x(e){e!=K&&(K=e,I(stateChangeCallbacks,e))}function I(e,t){for(var n=0;n<e.length;n++)e[n](t)}r.base=r.base||{},errorCallbacks=[];var y=[],A=[],E=[],L=[],T=null;r.base.displayId=r.base.displayId||null;for(var C=e(setInterval,y),N=n(clearInterval,y),S=["ms","moz","webkit","o"],k=r.requestAnimationFrame,w=r.cancelAnimationFrame,F=0;F<S.length&&!k;F++)k=r[S[F]+"RequestAnimationFrame"],w=r[S[F]+"CancelAnimationFrame"];var O=e(k,E),P=n(w,E),_=e(setTimeout,L),D=n(clearTimeout,L),j="webkit";errorCallbacks.push(function(e){var t;for(t=0;t<y.length;t++)N(y[t]);for(t=0;t<A.length;t++){var n=A[t];s(n.element,n.event,n.callback)}for(t=0;t<E.length;t++)P(E[t]);for(t=0;t<L.lenght;t++)clearTimeout(L[t])});var M={},B=[],G={},R="",W=-1,X=0,q={image:"img",spritesheet:"img",text:"text",json:"text",tilemap:"text"},H=!(!r.AudioContext&&!r.webkitAudioContext);r.base.indexFunc=r.base.indexFunc||null;var U={BASE_NOT_LOADED:0,INDEX_NOT_LOADED:1,ASSETS_LOADING:2,APP_INITING:3,APP_RUNNING:4},z="display",J=null,K=U.BASE_NOT_RUN;return stateChangeCallbacks=[],r.base.renderLoadingScreen=r.base.renderLoadingScreen||null,stateChangeCallbacks.push(function(e){e==U.APP_INITING&&(N(J),v())}),stateChangeCallbacks.push(b),i(document,"DOMContentLoaded",function(){v(z,W,X),J=C(h,100),x(U.INDEX_NOT_LOADED)},!1),{displayId:r.base.displayId,onError:a,runSafely:t,external:l,setInterval:C,clearInterval:N,addEventListener:i,removeEventListener:s,requestAnimationFrame:k,cancelAnimationFrame:P,setTimeout:setTimeout,clearTimeout:clearTimeout,customWindow:function(){var e=function(e){for(var t=e,n={};e;){for(var a=Object.getOwnPropertyNames(e),r=0;r<a.length;r++){var i,l=a[r];if(l.startsWith(j)){var s=l.slice(j.length);(i=e[s])||(i=e[s=s[0].toLowerCase()+s.slice(1)])||(i=e[l])}else i=e[l];n[l]="function"==typeof i?i.bind(t):i}e=Object.getPrototypeOf(e)}return n}(r);return e.setInterval=C,e.clearInterval=N,e.requestAnimationFrame=O,e.cancelAnimationFrame=P,e.setTimeout=_,e.clearTimeout=D,e},getErrorCallbacks:function(){return errorCallbacks},getRegisterCallbacks:function(){return B},registerModule:function(e,t){var n={name:e,scope:null,initFunc:t};M[e]=n,I(B,n)},importModule:o,getBasePath:function(){return R},setBasePath:function(e){R=e},hasWebAudio:function(){return H},indexFunc:r.base.indexFunc,getAsset:function(e){return G[e].data},getAssets:function(){return G},loadText:u,loadTag:d,loadAsset:f,loadAssets:function(e){for(var t=0;t<e.length;t++){var n=e[t];f(n[0],n[1],n[2],n[3])}},decrLoading:g,renderLoadingScreen:r.base.renderLoadingScreen,getStates:function(){return U},getStateChangeCallbacks:function(){return stateChangeCallbacks},getLoadingState:function(){return K},setLoadingState:function(e){x(e)}}}(this);