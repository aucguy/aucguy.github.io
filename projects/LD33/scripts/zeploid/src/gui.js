base.registerModule("gui",function(t){var E=base.importModule("engine");t.init=function(){r.instance=new r,E.World.instance.addSprite(r.instance)};var e=base.extend(E.Group,"Menu",{constructor:function(){this.constructor$Group(),this.addElements()},addElements:function(){}});t.Menu=e,EventButtonClick=base.extend(E.Event,"EventButtonClick",{constructor:function t(){this.constructor$Event(t.ID)}}),EventButtonClick.ID=E.Event.nextEventId();var n=base.extend(E.SimpleGraphic,"Button",{constructor:function(t,e,n,i){this.constructor$SimpleGraphic(E.makeCanvas(200,100),e,n),this.rect=new util.Rect(-1,-1,-1,-1),this.text=i;var r=resource.getResource("gui/button.svg");function o(t,e){var n=r.getElementById(t);n.parentNode.removeChild(n);var i=xml.copyAttributes(xml.ensureType(n,e),["x","y","width","height"]);return new util.Rect(safeParseInt(i.x),safeParseInt(i.y),safeParseInt(i.width),safeParseInt(i.height))}xml.removeMetadata(r);var s=o("leftrect","rect"),a=o("midrect","rect"),u=o("rightrect","rect"),c=new util.Rect(-1,-1,-1,-1),h=r.getElementById("text");h.parentNode.removeChild(h),c.left=h.getAttribute("x"),c.top=h.getAttribute("y");var l=E.makeCanvas(1,1).getContext("2d");l.font="20px Georgia",l.textBaseline="top";for(var d=0;d<h.childNodes.length;d++)if("tspan"==h.childNodes[d].nodeName){var v=l.measureText(h.innerHTML);c.width=v.width}var p=c.left-s.left,g=parseInt(r.getElementsByTagName("svg")[0].getAttribute("width")),f=parseInt(r.getElementsByTagName("svg")[0].getAttribute("height")),m=E.makeCanvas(g,f);m.getContext("2d").drawSvg(r,0,0,g,f),r=null;var w=visual.clipCanvas(m,s.left,s.top,s.width,s.height),x=visual.clipCanvas(m,a.left,a.top,a.width,a.height),C=visual.clipCanvas(m,u.left,u.top,u.width,u.height),y=(t=E.makeCanvas(0,w.height)).getContext("2d"),M=xml.copyAttributesFromStyle(h.getAttribute("style"),["font-size","font-family"]);M.font=M["font-size"]+" "+M["font-family"],y.font=M.font,y.textBaseline="bottom";var b=Math.ceil((y.measureText(this.text).width+p)/x.width);t.width=w.width+b*x.width+C.width,y.font=M.font,y.textBaseline="bottom",y.drawImage(w,0,0);var B=w.width;for(d=0;d<b;d++)y.drawImage(x,B,0),B+=x.width;y.drawImage(C,B,0),y.strokeStyle="#000000",y.strokeText(this.text,s.left+p,c.top),this.canvas=t,this.rect.left=this.getX(),this.rect.top=this.getY(),this.rect.width=this.canvas.width,this.rect.height=this.canvas.height},onMouseDown:E.listener(E.EventMouseDown.ID,function(t){this.rect.collidepoint(t.x,t.y)&&this.onEvent(new EventButtonClick(this))})});(t.Button=n).prototype.rect=null,n.prototype.text=null,n.prototype.compile();var i=base.extend(n,"ButtonMenuChange",{constructor:function(t,e,n,i,r){this.constructor$Button(t,e,n,i),this.menuConstr=r},onClicked:E.listener(EventButtonClick.ID,function(t){r.instance.setMenu(new this.menuConstr)})});(t.ButtonMenuChange=i).prototype.menuConstr=null,i.prototype.compile();var r=base.extend(E.Group,"MenuManager",{constructor:function(){this.constructor$Group(),this.currentMenu=null},setMenu:function(t){-0!=this.currentMenu&&this.removeSprite(this.currentMenu),null!==t&&this.addSprite(t),this.currentMenu=t}});(t.MenuManager=r).instance=null,r.prototype.currentMenu=null});