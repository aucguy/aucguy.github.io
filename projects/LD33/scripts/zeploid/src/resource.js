base.registerModule("resource",function(e){var s={},t=null,u=0;function i(e){t=e}function a(n,r,a,o){u++,e.ajax(l(t,r),function(e){try{var t=a(e.responseText);s[n]=t,null!==o&&o(t,n,r),u--}catch(e){throw u--,e}},function(e){throw u--,new Error("failed to retrieve asset "+n)})}e.setResourcePath=i,e.getResourcePath=function(e){return t},e.getLoading=function(){return u},e.loadResource=a,e.getResource=function(e){return s[e]},e.loadJson=function(e,t,n,r){a(e,t,function(e){return JSON.parse(e)},r)},e.loadImage=function(e,t,n,r){u++;var a=new Image;a.onload=function(){s[e]=a,null!==r&&r(a,e,t),u--},a.src=t},e.loadScript=function(e,t,n,r){u++;var a=document.createElement("script");a.src=t,document.head.appendChild(a),s[e]=a},e.loadXml=function(e,t,n,r){a(e,t,function(e){return base.importModule("xml").parseXml(e)},r)};var c={json:e.loadJson,image:e.loadImage,script:e.loadScript,xml:e.loadXml};function l(){for(var e=[],t=0,n=arguments.length;t<n;t++)""!==arguments[t]&&(e=e.concat(arguments[t].split("/")));var r=[];for(t=0,n=e.length;t<n;t++){var a=e[t];a&&"."!==a&&(".."===a?r.pop():r.push(a))}return""===e[0]&&r.unshift(""),r.join("/")||(r.length?"/":".")}e.ajax=function(t,e,n){var r;void 0===n&&(n=function(e){console.warn("resource "+t+" failed to load with a status of "+e.status)}),(r=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).onreadystatechange=base.external(function(){4==r.readyState&&(200==r.status||0===r.status?e(r):n(r))}),r.open("GET",t,!0),r.send()},e.query=function(e){var t=e.path;base.assertType(t,"string"),i(t);var n=e.resources;base.assertType(n,Array);for(var r=0;r<n.length;r++){var a=n[r],o=a.id,s=a.type,u=a.url;base.assertType(o,"string"),base.assertType(s,"string"),base.assertType(u,"string"),c[s](o,u,a,null)}},base.onModuleRegistered=function(){u--}});