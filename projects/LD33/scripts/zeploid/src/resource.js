base.registerModule("resource",function(e){function t(){base.onModuleRegistered=function(){i--}}function n(e){u=e}function r(t,n,r,a){i++,e.ajax(o(u,n),function(e){try{var o=r(e.responseText);s[t]=o,null!==a&&a(o,t,n),i--}catch(u){throw i--,u}},function(e){throw i--,new Error("failed to retrieve asset "+t)})}function a(e,t,n){"undefined"==typeof n&&(n=function(t){console.warn("resource "+e+" failed to load with a status of "+t.status)});var r;r=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),r.onreadystatechange=base.external(function(){4==r.readyState&&(200==r.status||0===r.status?t(r):n(r))}),r.open("GET",e,!0),r.send()}function o(){for(var e=[],t=0,n=arguments.length;n>t;t++)""!==arguments[t]&&(e=e.concat(arguments[t].split("/")));var r=[];for(t=0,n=e.length;n>t;t++){var a=e[t];a&&"."!==a&&(".."===a?r.pop():r.push(a))}return""===e[0]&&r.unshift(""),r.join("/")||(r.length?"/":".")}var s={},u=null,i=0;e.setResourcePath=n,e.getResourcePath=function(e){return u},e.getLoading=function(){return i},e.loadResource=r,e.getResource=function(e){return s[e]},e.loadJson=function(e,t,n,a){r(e,t,function(e){return JSON.parse(e)},a)},e.loadImage=function(e,t,n,r){i++;var a=new Image;a.onload=function(){s[e]=a,null!==r&&r(a,e,t),i--},a.src=t},e.loadScript=function(e,t,n,r){i++;var a=document.createElement("script");a.src=t,document.head.appendChild(a),s[e]=a},e.loadXml=function(e,t,n,a){r(e,t,function(e){var t=base.importModule("xml");return t.parseXml(e)},a)};var c={json:e.loadJson,image:e.loadImage,script:e.loadScript,xml:e.loadXml};e.ajax=a,e.query=function(e){var t=e.path;base.assertType(t,"string"),n(t);var r=e.resources;base.assertType(r,Array);for(var a=0;a<r.length;a++){var o=r[a],s=o.id,u=o.type,i=o.url;base.assertType(s,"string"),base.assertType(u,"string"),base.assertType(i,"string"),c[u](s,i,o,null)}},t()});