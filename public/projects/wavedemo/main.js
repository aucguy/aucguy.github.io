base.registerModule("main",function(t){var a,n=0,i=!1;function e(t,e){t.sprites=[];var n=(a.width-25-25)/(e.nodeCount+2),i=a.height/2,o=25,s=new l,r=new l;t.addSprite(r),t.addSprite(s);var c=[],u=new f(util.Vector.get(o,i),e.amplitude,e.frequency);c.push(u),s.addSprite(u),o+=n;for(var d=0;d<e.nodeCount;d++)u=new p(util.Vector.get(o,i),e.friction/100),c.push(u),s.addSprite(u),o+=n;u=new g(util.Vector.get(o,i)),c.push(u),s.addSprite(u);for(d=0;d<e.nodeCount+1;d++){var h=new m(c[d],c[d+1],e.tension);r.addSprite(h),h.bind()}}function o(){if(i)t=0;else{var t=n;if(n=(new Date).getTime()/1e3,0!=t){var e=n-t;r.instance.update(Math.min(e,.01))}}r.instance.render(a.getContext("2d")),requestAnimationFrame(o)}var s=extend(Object,"Sprite",{constructor:function(t){this.position=util.Vector.get(),this.graphic=t,this.parent=null},update:function(t){},render:function(t){t.drawImage(this.graphic,this.position.x,this.position.y)},onAdded:function(t){if(null!=this.parent)throw new Error("Sprite added to a group when it was already in one");this.parent=t},onRemoved:function(t){if(this.parent!=t)throw new Error("Sprite removed from a group it wasn't in");this.parent=null}}),l=extend(s,"Group",{constructor:function(){this.constructor$Sprite(),this.sprites=[]},update:function(t){for(var e=0;e<this.sprites.length;e++)this.sprites[e].update(t)},render:function(t){for(var e=0;e<this.sprites.length;e++)this.sprites[e].render(t)},addSprite:function(t){this.sprites.push(t),t.onAdded(this)},removeSprite:function(t){this.sprites.splice(this.sprites.indexOf(t),1),t.onRemoved(this)}}),r=extend(l,"World",{constructor:function(t){this.constructor$Group(),this.backgroundColor=t},render:function(t){t.fillStyle=this.backgroundColor,t.fillRect(0,0,t.canvas.width,t.canvas.height),this.render$Group(t)}}),c=extend(s,"Node",{constructor:function(t){this.constructor$Sprite(),this.position=t,this.velocity=util.Vector.get(0,0),this.connections=[]},update:function(t){this.update$Sprite(t),this.velocity.increment(this.getAcceleration());var e=this.velocity.copy();e.m*=t,this.position.increment(e)},render:function(t){t.fillStyle="#000000",t.fillRect(this.position.x,this.position.y,10,10)},getAcceleration:function(){throw new Error("Abstract Method")}}),p=extend(c,"PhysicalNode",{constructor:function(t,e){this.constructor$Node(t),this.mass=1,this.friction=e},getAcceleration:function(){for(var t=util.Vector.get(0,0),e=0;e<this.connections.length;e++)t.increment(this.connections[e].getForce(this));return t.m/=this.mass,t},update:function(t){this.update$Node(t),this.velocity.m-=this.friction}}),f=extend(c,"MovingNode",{constructor:function(t,e,n){this.constructor$Node(t),this.amplitude=e,this.frequency=n,this.time=0},getAcceleration:function(){return util.Vector.get(0,0)},update:function(t){this.update$Node(t),this.time+=t,this.position.y=Math.floor(Math.sin(this.time*this.frequency/25)*this.amplitude)+a.height/2}}),g=extend(c,"StaticNode",{constructor:function(t){this.constructor$Node(t)},getAcceleration:function(){return util.Vector.get(0,0)}}),m=extend(s,"Connection",{constructor:function(t,e,n){this.nodeA=t,this.nodeB=e,this.strength=n,this.force=null},bind:function(){this.give(this.nodeA),this.give(this.nodeB)},give:function(t){-1==t.connections.indexOf(this)&&t.connections.push(this)},getForce:function(t){return t==this.nodeA?this.force:t==this.nodeB?this.force.opposite():null},render:function(t){t.strokeStyle="#FF0000",t.beginPath(),t.moveTo(this.nodeA.position.x+5,this.nodeA.position.y+5),t.lineTo(this.nodeB.position.x+5,this.nodeB.position.y+5),t.stroke()},update:function(t){this.force=this.nodeB.position.sub(this.nodeA.position),this.force.m*=this.strength*t}});Settings=extend(Object,"Settings",{constructor:function(){this.nodeCount=safeParseInt(document.getElementById("nodeCount").value),this.frequency=safeParseInt(document.getElementById("frequency").value),this.amplitude=safeParseInt(document.getElementById("amplitude").value),this.tension=document.getElementById("tension").value,this.friction=document.getElementById("friction").value}}),r.instance=null,a=document.getElementById("display"),r.instance=new r("#F8F8F8"),requestAnimationFrame(o),document.getElementById("sync-settings").addEventListener("click",external(function(){e(r.instance,new Settings)})),window.addEventListener("blur",external(function(){i=!0})),window.addEventListener("focus",external(function(){i=!1})),e(r.instance,new Settings)});