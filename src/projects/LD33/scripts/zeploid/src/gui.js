"use strict";base.registerModule("gui",function(t){var B=base.importModule("engine");t.init=function(){o.instance=new o,B.World.instance.addSprite(o.instance)};var e=base.extend(B.Group,"Menu",{constructor:function(){this.constructor$Group(),this.addElements()},addElements:function(){}});t.Menu=e;var n=base.extend(B.Event,"EventButtonClick",{constructor:function t(){this.constructor$Event(t.ID)}});n.ID=B.Event.nextEventId();var i=base.extend(B.SimpleGraphic,"Button",{constructor:function(t,e,n,i){this.constructor$SimpleGraphic(B.makeCanvas(200,100),e,n),this.rect=new util.Rect(-1,-1,-1,-1),this.text=i;var r=resource.getResource("gui/button.svg");function o(t,e){var n=r.getElementById(t);n.parentNode.removeChild(n);var i=xml.copyAttributes(xml.ensureType(n,e),["x","y","width","height"]);return new util.Rect(safeParseInt(i.x),safeParseInt(i.y),safeParseInt(i.width),safeParseInt(i.height))}xml.removeMetadata(r);var s=o("leftrect","rect"),a=o("midrect","rect"),u=o("rightrect","rect"),c=new util.Rect(-1,-1,-1,-1),h=r.getElementById("text");h.parentNode.removeChild(h),c.left=h.getAttribute("x"),c.top=h.getAttribute("y");var l=B.makeCanvas(1,1).getContext("2d");l.font="20px Georgia",l.textBaseline="top";for(var d=0;d<h.childNodes.length;d++)if("tspan"==h.childNodes[d].nodeName){var p=l.measureText(h.innerHTML);c.width=p.width}var v=c.left-s.left,g=parseInt(r.getElementsByTagName("svg")[0].getAttribute("width")),f=parseInt(r.getElementsByTagName("svg")[0].getAttribute("height")),m=B.makeCanvas(g,f);m.getContext("2d").drawSvg(r,0,0,g,f),r=null;var w=visual.clipCanvas(m,s.left,s.top,s.width,s.height),x=visual.clipCanvas(m,a.left,a.top,a.width,a.height),y=visual.clipCanvas(m,u.left,u.top,u.width,u.height),M=(t=B.makeCanvas(0,w.height)).getContext("2d"),C=xml.copyAttributesFromStyle(h.getAttribute("style"),["font-size","font-family"]);C.font=C["font-size"]+" "+C["font-family"],M.font=C.font,M.textBaseline="bottom";var b=Math.ceil((M.measureText(this.text).width+v)/x.width);t.width=w.width+b*x.width+y.width,M.font=C.font,M.textBaseline="bottom",M.drawImage(w,0,0);var I=w.width;for(d=0;d<b;d++)M.drawImage(x,I,0),I+=x.width;M.drawImage(y,I,0),M.strokeStyle="#000000",M.strokeText(this.text,s.left+v,c.top),this.canvas=t,this.rect.left=this.getX(),this.rect.top=this.getY(),this.rect.width=this.canvas.width,this.rect.height=this.canvas.height},onMouseDown:B.listener(B.EventMouseDown.ID,function(t){this.rect.collidepoint(t.x,t.y)&&this.onEvent(new n(this))})});(t.Button=i).prototype.rect=null,i.prototype.text=null,i.prototype.compile();var r=base.extend(i,"ButtonMenuChange",{constructor:function(t,e,n,i,r){this.constructor$Button(t,e,n,i),this.menuConstr=r},onClicked:B.listener(n.ID,function(t){o.instance.setMenu(new this.menuConstr)})});(t.ButtonMenuChange=r).prototype.menuConstr=null,r.prototype.compile();var o=base.extend(B.Group,"MenuManager",{constructor:function(){this.constructor$Group(),this.currentMenu=null},setMenu:function(t){-0!=this.currentMenu&&this.removeSprite(this.currentMenu),null!==t&&this.addSprite(t),this.currentMenu=t}});(t.MenuManager=o).instance=null,o.prototype.currentMenu=null});